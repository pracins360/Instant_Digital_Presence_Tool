<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Orbit Promo - 30-Day Pilot (South Africa & Cura√ßao)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    /* CRITICAL CSS ONLY - OPTIMIZED */
    :root { font-family: system-ui; line-height: 1.6; }
    body { margin: 0; background: #0f172a; color: #e5e7eb; min-height: 100vh; display: flex; justify-content: center; align-items: center; padding: 1rem; }
    .container { max-width: 1200px; width: 100%; background: #020617; border-radius: 1rem; overflow: hidden; box-shadow: 0 10px 30px rgba(0,0,0,0.3); display: flex; }
    @media (max-width: 768px) { .container { flex-direction: column; } }
    .panel { padding: 1.5rem; flex: 1; }
    .generator { background: radial-gradient(circle at top left, #1d4ed8, #020617 60%); }
    
    /* Country Selection */
    .country-selector { 
      background: linear-gradient(135deg, #1e3a8a, #1e40af); 
      color: white; 
      padding: 1rem; 
      border-radius: 0.5rem; 
      margin-bottom: 1rem; 
      text-align: center; 
    }
    .country-flag { font-size: 1.5rem; margin-right: 0.5rem; }
    .country-limit { 
      font-size: 0.85rem; 
      background: rgba(255,255,255,0.1); 
      padding: 0.25rem 0.5rem; 
      border-radius: 1rem; 
      margin-left: 0.5rem; 
    }
    
    /* Pilot Banner */
    .pilot-banner { 
      background: linear-gradient(135deg, #7c3aed, #6d28d9); 
      color: white; 
      padding: 1rem; 
      border-radius: 0.5rem; 
      margin-bottom: 1rem; 
      text-align: center; 
    }
    .pilot-counter { font-size: 1.1rem; font-weight: 600; margin: 0.5rem 0; }
    
    h1 { margin: 0 0 0.5rem; font-size: 1.5rem; color: white; }
    .field { margin-bottom: 1rem; }
    label { display: block; margin-bottom: 0.25rem; font-size: 0.9rem; }
    input, textarea, select { 
      width: 100%; padding: 0.6rem; border-radius: 0.4rem; 
      border: 1px solid #334155; background: #1e293b; 
      color: white; box-sizing: border-box; 
    }
    input:disabled, textarea:disabled { background: #374151; color: #9ca3af; cursor: not-allowed; }
    textarea { min-height: 60px; resize: vertical; }
    button { 
      background: #22c55e; color: #022c22; border: none; 
      padding: 0.7rem 1.5rem; border-radius: 2rem; font-weight: 600; 
      cursor: pointer; width: 100%; 
    }
    .output { margin: 1rem 0; }
    .output textarea { font-family: monospace; font-size: 0.8rem; background: #1e293b; }
    .url-actions { display: flex; gap: 0.5rem; margin-top: 0.5rem; flex-wrap: wrap; }
    .url-actions button { width: auto; padding: 0.4rem 1rem; font-size: 0.8rem; }
    
    .preview { background: #020617; border-left: 1px solid #334155; }
    .preview-shell { background: white; color: #1f2937; border-radius: 0.5rem; overflow: hidden; margin: 1rem 0; }
    .preview-header { padding: 1rem; background: #1e293b; color: white; }
    .preview-body { padding: 1rem; }
    
    /* Country Limits & Statistics */
    .country-stats { 
      background: rgba(30, 64, 175, 0.2); 
      border: 1px solid rgba(30, 64, 175, 0.5); 
      border-radius: 0.5rem; 
      padding: 1rem; 
      margin: 1rem 0; 
    }
    .stats-grid { 
      display: grid; 
      grid-template-columns: repeat(3, 1fr); 
      gap: 0.5rem; 
      margin-top: 0.5rem; 
    }
    .stat-item { text-align: center; }
    .stat-number { font-size: 1.2rem; font-weight: 700; color: #22c55e; }
    .stat-label { font-size: 0.7rem; color: #9ca3af; }
    
    /* Promoter Dashboard */
    .dashboard { display: none; }
    .campaign-list { max-height: 400px; overflow-y: auto; }
    .campaign-item { 
      background: rgba(15,23,42,0.8); 
      border: 1px solid #334155; 
      border-radius: 0.5rem; 
      padding: 0.75rem; 
      margin: 0.5rem 0; 
    }
    
    /* Admin Controls */
    .admin-panel { 
      background: rgba(220, 38, 38, 0.1); 
      border: 1px solid rgba(220, 38, 38, 0.3); 
      border-radius: 0.5rem; 
      padding: 1rem; 
      margin: 1rem 0; 
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Generator Panel -->
    <div class="panel generator">
      
      <!-- PILOT BANNER -->
      <div class="pilot-banner">
        <div>üöÄ 60-DAY PILOT PROGRAM</div>
        <div class="pilot-counter" id="pilotCounter">Dec 2024 - Jan 2025</div>
        <div style="font-size: 0.85rem;">South Africa (500 stores max) ‚Ä¢ Cura√ßao (200 stores max)</div>
      </div>
      
      <!-- COUNTRY SELECTOR -->
      <div class="country-selector" id="countrySelector">
        <h3 style="margin-top: 0; color: white;">üåç Select Your Country</h3>
        <p style="font-size: 0.9rem;">This pilot has limited spots per country</p>
        
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin: 1rem 0;">
          <div class="country-option" data-country="ZA">
            <div style="background: rgba(255,255,255,0.1); padding: 1rem; border-radius: 0.5rem; text-align: center; cursor: pointer;">
              <div class="country-flag">üáøüá¶</div>
              <div style="font-weight: 600;">South Africa</div>
              <div class="country-limit" id="zaLimit">0/500 spots</div>
            </div>
          </div>
          
          <div class="country-option" data-country="CW">
            <div style="background: rgba(255,255,255,0.1); padding: 1rem; border-radius: 0.5rem; text-align: center; cursor: pointer;">
              <div class="country-flag">üá®üáº</div>
              <div style="font-weight: 600;">Cura√ßao</div>
              <div class="country-limit" id="cwLimit">0/200 spots</div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- COUNTRY STATISTICS -->
      <div class="country-stats" id="countryStats" style="display: none;">
        <div style="display: flex; justify-content: space-between; align-items: center;">
          <div>
            <strong id="selectedCountryName">Country</strong>
            <div id="selectedCountryFlag" class="country-flag"></div>
          </div>
          <div id="countryProgress"></div>
        </div>
        
        <div class="stats-grid">
          <div class="stat-item">
            <div class="stat-number" id="totalStores">0</div>
            <div class="stat-label">Total Stores</div>
          </div>
          <div class="stat-item">
            <div class="stat-number" id="activePromos">0</div>
            <div class="stat-label">Active Promos</div>
          </div>
          <div class="stat-item">
            <div class="stat-number" id="daysLeft">60</div>
            <div class="stat-label">Days Left</div>
          </div>
        </div>
      </div>
      
      <!-- MAIN FORM (Hidden until country selection) -->
      <div id="mainForm" style="display: none;">
        <h1>Create Promo Page</h1>
        
        <form id="campaignForm">
          <!-- Promoter Code (Optional) -->
          <div class="field">
            <label for="promoterCode">Promoter Code (if you have one)</label>
            <input type="text" id="promoterCode" placeholder="e.g., IRVING001">
            <small>Helps promoters track their referrals</small>
          </div>
          
          <div class="field">
            <label for="businessName">Business Name *</label>
            <input type="text" id="businessName" placeholder="Your Business" required>
          </div>
          
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem;">
            <div class="field">
              <label for="businessPhone">Phone *</label>
              <input type="tel" id="businessPhone" placeholder="+27 61 234 5678" required>
            </div>
            <div class="field">
              <label for="businessEmail">Email</label>
              <input type="email" id="businessEmail" placeholder="hello@business.com">
            </div>
          </div>
          
          <div class="field">
            <label for="businessAddress">Address</label>
            <input type="text" id="businessAddress" placeholder="Street, City">
          </div>
          
          <div class="field">
            <label for="offerText">Special Offer *</label>
            <textarea id="offerText" placeholder="Describe your promotion..." required></textarea>
          </div>
          
          <!-- Featured Image (Included in pilot) -->
          <div class="field">
            <label for="featuredImage">Featured Image URL</label>
            <input type="text" id="featuredImage" placeholder="https://example.com/image.jpg">
            <small>Free during pilot - shows your offer</small>
          </div>
          
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem;">
            <div class="field">
              <label for="startDate">Start Date</label>
              <input type="date" id="startDate">
            </div>
            <div class="field">
              <label for="endDate">End Date *</label>
              <input type="date" id="endDate" required>
              <small>Max 60 days (pilot period)</small>
            </div>
          </div>
          
          <div class="field">
            <label for="contactChannel">How should customers contact you?</label>
            <select id="contactChannel">
              <option value="whatsapp">WhatsApp</option>
              <option value="phone">Phone Call</option>
              <option value="visit">Store Visit</option>
              <option value="email">Email</option>
            </select>
          </div>
          
          <!-- Owner Contact (For upgrade follow-up) -->
          <div class="field">
            <label for="ownerName">Your Name *</label>
            <input type="text" id="ownerName" placeholder="Your full name" required>
            <small>For upgrade notifications</small>
          </div>
          
          <button type="submit">üöÄ Create Promo Page</button>
        </form>
        
        <!-- Generated URL -->
        <div class="output" id="outputSection" style="display: none;">
          <label>Your Promo URL:</label>
          <textarea id="generatedUrl" readonly></textarea>
          <div class="url-actions">
            <button onclick="copyUrl()">üìã Copy URL</button>
            <button onclick="shortenUrl()" style="background: #3b82f6;">üîó Shorten & Get QR</button>
            <button onclick="generateFlyer()" style="background: #8b5cf6;">üñ®Ô∏è Create Flyer</button>
          </div>
        </div>
      </div>
      
      <!-- ADMIN PANEL (Hidden by default) -->
      <div class="admin-panel" id="adminPanel" style="display: none;">
        <h3 style="color: #dc2626; margin-top: 0;">üîí Admin Dashboard</h3>
        <div class="stats-grid">
          <div class="stat-item">
            <div class="stat-number" id="adminTotal">0</div>
            <div class="stat-label">Total Campaigns</div>
          </div>
          <div class="stat-item">
            <div class="stat-number" id="adminZA">0/500</div>
            <div class="stat-label">South Africa</div>
          </div>
          <div class="stat-item">
            <div class="stat-number" id="adminCW">0/200</div>
            <div class="stat-label">Cura√ßao</div>
          </div>
        </div>
        <button onclick="exportData()" style="background: #dc2626; margin-top: 0.5rem;">üìä Export All Data</button>
        <button onclick="resetPilot()" style="background: #f59e0b; margin-top: 0.5rem;">üîÑ Reset Pilot Data</button>
      </div>
      
    </div>
    
    <!-- Preview Panel -->
    <div class="panel preview">
      <h2 style="color: white; margin-top: 0;">Live Preview</h2>
      <div id="previewContent">
        <div class="preview-shell">
          <div class="preview-header">
            <h3 style="margin: 0;">Your Business</h3>
          </div>
          <div class="preview-body">
            <p>Select your country and fill the form to see preview...</p>
          </div>
        </div>
      </div>
      
      <!-- Pilot Statistics -->
      <div class="country-stats" style="margin-top: 2rem;">
        <h3 style="margin-top: 0;">üìä Pilot Statistics</h3>
        <div class="stats-grid">
          <div class="stat-item">
            <div class="stat-number" id="pilotTotal">0</div>
            <div class="stat-label">Total Stores</div>
          </div>
          <div class="stat-item">
            <div class="stat-number" id="pilotToday">0</div>
            <div class="stat-label">Today</div>
          </div>
          <div class="stat-item">
            <div class="stat-number" id="pilotRemaining">700</div>
            <div class="stat-label">Spots Left</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ===== 60-DAY PILOT MANAGEMENT =====
    class PilotManager {
      constructor() {
        this.pilotStart = new Date('2024-12-01');
        this.pilotEnd = new Date('2025-01-31');
        this.countryLimits = {
          'ZA': 500, // South Africa
          'CW': 200  // Cura√ßao
        };
        this.currentCountry = null;
      }
      
      getDaysRemaining() {
        const now = new Date();
        const diff = this.pilotEnd - now;
        return Math.max(0, Math.ceil(diff / (1000 * 60 * 60 * 24)));
      }
      
      getPilotProgress() {
        const now = new Date();
        const totalDays = 61; // Dec + Jan
        const daysPassed = Math.floor((now - this.pilotStart) / (1000 * 60 * 60 * 24));
        return Math.min(100, Math.max(0, (daysPassed / totalDays) * 100));
      }
      
      selectCountry(countryCode) {
        if (!this.countryLimits[countryCode]) {
          alert('Invalid country selection');
          return false;
        }
        
        const currentCount = this.getCountryCount(countryCode);
        const limit = this.countryLimits[countryCode];
        
        if (currentCount >= limit) {
          alert(`‚ùå Sorry! ${this.getCountryName(countryCode)} has reached its limit of ${limit} stores.\n\nPlease try another country or contact support.`);
          return false;
        }
        
        this.currentCountry = countryCode;
        localStorage.setItem('selectedCountry', countryCode);
        return true;
      }
      
      getCountryName(code) {
        return {
          'ZA': 'South Africa',
          'CW': 'Cura√ßao'
        }[code] || 'Unknown';
      }
      
      getCountryFlag(code) {
        return {
          'ZA': 'üáøüá¶',
          'CW': 'üá®üáº'
        }[code] || 'üåç';
      }
      
      getCountryCount(countryCode) {
        const campaigns = JSON.parse(localStorage.getItem('orbitCampaigns') || '{}');
        return Object.values(campaigns).filter(c => c.country === countryCode).length;
      }
      
      getTodayCount() {
        const today = new Date().toDateString();
        const campaigns = JSON.parse(localStorage.getItem('orbitCampaigns') || '{}');
        return Object.values(campaigns).filter(c => {
          const created = new Date(c.created).toDateString();
          return created === today;
        }).length;
      }
      
      canCreateCampaign(countryCode) {
        const current = this.getCountryCount(countryCode);
        return current < this.countryLimits[countryCode];
      }
      
      registerCampaign(data) {
        const campaigns = JSON.parse(localStorage.getItem('orbitCampaigns') || '{}');
        const campaignId = 'campaign_' + Date.now();
        
        campaigns[campaignId] = {
          id: campaignId,
          country: this.currentCountry,
          business: data.businessName,
          phone: data.phone,
          email: data.email,
          address: data.address,
          offer: data.offer,
          owner: data.ownerName,
          promoter: data.promoterCode,
          created: new Date().toISOString(),
          expiry: data.endDate,
          status: 'active'
        };
        
        localStorage.setItem('orbitCampaigns', JSON.stringify(campaigns));
        this.updateStatistics();
        return campaignId;
      }
      
      updateStatistics() {
        // Update all statistic displays
        const totalZA = this.getCountryCount('ZA');
        const totalCW = this.getCountryCount('CW');
        const totalAll = totalZA + totalCW;
        const todayCount = this.getTodayCount();
        const daysLeft = this.getDaysRemaining();
        
        // Update country limits display
        document.getElementById('zaLimit').textContent = `${totalZA}/500`;
        document.getElementById('cwLimit').textContent = `${totalCW}/200`;
        
        // Update stats in preview panel
        document.getElementById('pilotTotal').textContent = totalAll;
        document.getElementById('pilotToday').textContent = todayCount;
        document.getElementById('pilotRemaining').textContent = 700 - totalAll;
        
        // Update selected country stats
        if (this.currentCountry) {
          const countryCount = this.getCountryCount(this.currentCountry);
          const limit = this.countryLimits[this.currentCountry];
          const progress = Math.round((countryCount / limit) * 100);
          
          document.getElementById('totalStores').textContent = countryCount;
          document.getElementById('countryProgress').innerHTML = `
            <div style="font-size: 0.8rem;">
              <div style="background: #334155; height: 6px; border-radius: 3px; width: 100px; margin: 2px 0;">
                <div style="background: #22c55e; height: 100%; width: ${progress}%; border-radius: 3px;"></div>
              </div>
              <div>${progress}% filled</div>
            </div>
          `;
        }
        
        // Update admin panel
        document.getElementById('adminTotal').textContent = totalAll;
        document.getElementById('adminZA').textContent = `${totalZA}/500`;
        document.getElementById('adminCW').textContent = `${totalCW}/200`;
      }
    }

    // ===== MAIN APPLICATION =====
    const pilotManager = new PilotManager();
    let currentQR = null;

    // Initialize
    document.addEventListener('DOMContentLoaded', function() {
      initializeApp();
      checkAdminAccess();
      setDefaultDates();
    });

    function initializeApp() {
      // Setup country selection
      document.querySelectorAll('.country-option').forEach(option => {
        option.addEventListener('click', function() {
          const countryCode = this.dataset.country;
          handleCountrySelection(countryCode);
        });
      });
      
      // Setup form submission
      document.getElementById('campaignForm').addEventListener('submit', function(e) {
        e.preventDefault();
        createCampaign();
      });
      
      // Load statistics
      pilotManager.updateStatistics();
      
      // Check if country already selected
      const savedCountry = localStorage.getItem('selectedCountry');
      if (savedCountry && pilotManager.canCreateCampaign(savedCountry)) {
        handleCountrySelection(savedCountry, true);
      }
    }

    function handleCountrySelection(countryCode, silent = false) {
      if (pilotManager.selectCountry(countryCode)) {
        // Show main form
        document.getElementById('mainForm').style.display = 'block';
        document.getElementById('countrySelector').style.display = 'none';
        document.getElementById('countryStats').style.display = 'block';
        
        // Update country info
        document.getElementById('selectedCountryName').textContent = pilotManager.getCountryName(countryCode);
        document.getElementById('selectedCountryFlag').textContent = pilotManager.getCountryFlag(countryCode);
        document.getElementById('daysLeft').textContent = pilotManager.getDaysRemaining();
        
        // Update statistics
        pilotManager.updateStatistics();
        
        if (!silent) {
          alert(`üéâ Welcome ${pilotManager.getCountryName(countryCode)}!\n\nYou've selected ${pilotManager.getCountryFlag(countryCode)} ${pilotManager.getCountryName(countryCode)}.\n\nSpots available: ${pilotManager.countryLimits[countryCode] - pilotManager.getCountryCount(countryCode)}`);
        }
      }
    }

    function checkAdminAccess() {
      const urlParams = new URLSearchParams(window.location.search);
      if (urlParams.get('admin') === 'orbit2024') {
        document.getElementById('adminPanel').style.display = 'block';
      }
    }

    function setDefaultDates() {
      const today = new Date();
      const endDate = new Date();
      endDate.setDate(today.getDate() + 30); // Default 30-day promo
      
      document.getElementById('startDate').value = today.toISOString().split('T')[0];
      document.getElementById('endDate').valueAsDate = endDate;
      
      // Ensure end date doesn't exceed pilot end
      const pilotEnd = new Date('2025-01-31');
      document.getElementById('endDate').max = pilotEnd.toISOString().split('T')[0];
    }

    function createCampaign() {
      // Validate country selection
      if (!pilotManager.currentCountry) {
        alert('Please select your country first');
        return;
      }
      
      // Validate end date (max 60 days from start)
      const startDate = new Date(document.getElementById('startDate').value);
      const endDate = new Date(document.getElementById('endDate').value);
      const maxEndDate = new Date(startDate);
      maxEndDate.setDate(maxEndDate.getDate() + 60);
      
      if (endDate > maxEndDate) {
        alert(`Promo cannot exceed 60 days. Please select an end date before ${maxEndDate.toLocaleDateString()}`);
        return;
      }
      
      if (endDate > pilotManager.pilotEnd) {
        alert(`Promo cannot extend beyond pilot end date (Jan 31, 2025)`);
        return;
      }
      
      // Collect form data
      const campaignData = {
        businessName: document.getElementById('businessName').value,
        phone: document.getElementById('businessPhone').value,
        email: document.getElementById('businessEmail').value,
        address: document.getElementById('businessAddress').value,
        offer: document.getElementById('offerText').value,
        featuredImage: document.getElementById('featuredImage').value,
        startDate: document.getElementById('startDate').value,
        endDate: document.getElementById('endDate').value,
        contactChannel: document.getElementById('contactChannel').value,
        ownerName: document.getElementById('ownerName').value,
        promoterCode: document.getElementById('promoterCode').value
      };
      
      // Register campaign
      const campaignId = pilotManager.registerCampaign(campaignData);
      
      // Generate URL
      const params = new URLSearchParams({
        id: campaignId,
        country: pilotManager.currentCountry,
        biz: campaignData.businessName,
        phone: campaignData.phone,
        offer: campaignData.offer,
        end: campaignData.endDate,
        mode: 'promo'
      });
      
      if (campaignData.featuredImage) params.set('img', campaignData.featuredImage);
      if (campaignData.email) params.set('email', campaignData.email);
      if (campaignData.address) params.set('addr', campaignData.address);
      
      const url = window.location.origin + window.location.pathname + '?' + params.toString();
      
      // Display results
      document.getElementById('generatedUrl').value = url;
      document.getElementById('outputSection').style.display = 'block';
      
      // Update preview
      updatePreview(campaignData);
      
      // Show success message
      showSuccessMessage(campaignData, campaignId);
    }

    function updatePreview(data) {
      const preview = document.getElementById('previewContent');
      preview.innerHTML = `
        <div class="preview-shell">
          <div class="preview-header">
            <h3 style="margin: 0;">${data.businessName}</h3>
            <div style="font-size: 0.8rem; margin-top: 0.25rem;">
              ${pilotManager.getCountryFlag(pilotManager.currentCountry)} ${pilotManager.getCountryName(pilotManager.currentCountry)}
            </div>
          </div>
          <div class="preview-body">
            <p><strong>Special Offer:</strong> ${data.offer}</p>
            ${data.phone ? `<p>üìû ${data.phone} (${data.contactChannel})</p>` : ''}
            ${data.email ? `<p>üìß ${data.email}</p>` : ''}
            ${data.address ? `<p>üìç ${data.address}</p>` : ''}
            ${data.featuredImage ? `<img src="${data.featuredImage}" style="width: 100%; border-radius: 0.5rem; margin: 0.5rem 0;">` : ''}
            <div style="margin-top: 1rem; padding: 0.5rem; background: #f0fdf4; border-radius: 0.25rem;">
              <strong>60-Day Pilot Program</strong>
              <div style="font-size: 0.8rem; color: #666;">
                Valid until: ${new Date(data.endDate).toLocaleDateString()}
              </div>
            </div>
          </div>
        </div>
      `;
    }

    function showSuccessMessage(data, campaignId) {
      const stats = pilotManager;
      const countryCount = stats.getCountryCount(pilotManager.currentCountry);
      const limit = stats.countryLimits[pilotManager.currentCountry];
      const spotsLeft = limit - countryCount;
      
      const message = `
üéâ PROMO PAGE CREATED!

‚úÖ Your 60-day pilot promo is active
‚úÖ Country: ${pilotManager.getCountryFlag(pilotManager.currentCountry)} ${pilotManager.getCountryName(pilotManager.currentCountry)}
‚úÖ Available spots left: ${spotsLeft}/${limit}

üìä PILOT STATISTICS:
‚Ä¢ Total stores in ${pilotManager.getCountryName(pilotManager.currentCountry)}: ${countryCount}
‚Ä¢ Today's signups: ${stats.getTodayCount()}
‚Ä¢ Pilot days remaining: ${stats.getDaysRemaining()}

üìù NEXT STEPS:
1. Share your URL with customers
2. Use "Shorten & Get QR" for a QR code
3. Use "Create Flyer" for print materials

‚ö†Ô∏è IMPORTANT:
‚Ä¢ This promo ends on ${new Date(data.endDate).toLocaleDateString()}
‚Ä¢ After pilot (Jan 31), contact for upgrade options
‚Ä¢ Keep your campaign ID: ${campaignId}
      `;
      
      alert(message);
    }

    function copyUrl() {
      const url = document.getElementById('generatedUrl');
      url.select();
      navigator.clipboard.writeText(url.value).then(() => {
        alert('URL copied to clipboard!');
      });
    }

    function shortenUrl() {
      const longUrl = document.getElementById('generatedUrl').value;
      window.open(`https://tinyurl.com/create.php?url=${encodeURIComponent(longUrl)}`, '_blank');
    }

    function generateFlyer() {
      const url = document.getElementById('generatedUrl').value;
      const bizName = document.getElementById('businessName').value;
      const offer = document.getElementById('offerText').value;
      
      alert(`üñ®Ô∏è Flyer Generator Coming Soon!\n\nBusiness: ${bizName}\nOffer: ${offer.substring(0, 50)}...\n\nFor now, use the URL with your design tools.`);
    }

    // ===== ADMIN FUNCTIONS =====
    function exportData() {
      const campaigns = JSON.parse(localStorage.getItem('orbitCampaigns') || '{}');
      const dataStr = JSON.stringify(campaigns, null, 2);
      const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
      
      const exportFileDefaultName = `orbit-pilot-export-${new Date().toISOString().split('T')[0]}.json`;
      
      const linkElement = document.createElement('a');
      linkElement.setAttribute('href', dataUri);
      linkElement.setAttribute('download', exportFileDefaultName);
      linkElement.click();
    }

    function resetPilot() {
      if (confirm('‚ö†Ô∏è ARE YOU SURE?\n\nThis will delete ALL pilot data including:\n‚Ä¢ All campaigns\n‚Ä¢ Country statistics\n‚Ä¢ Promoter tracking\n\nThis action cannot be undone!')) {
        localStorage.removeItem('orbitCampaigns');
        localStorage.removeItem('selectedCountry');
        pilotManager.updateStatistics();
        alert('‚úÖ Pilot data reset. Starting fresh.');
        location.reload();
      }
    }

    // ===== VIEW PROMO PAGE =====
    function handlePromoView() {
      const params = new URLSearchParams(window.location.search);
      if (params.get('mode') === 'promo') {
        const countryCode = params.get('country');
        const countryName = pilotManager.getCountryName(countryCode);
        const countryFlag = pilotManager.getCountryFlag(countryCode);
        
        document.querySelector('.container').innerHTML = `
          <div class="panel" style="width: 100%; max-width: 500px; margin: 0 auto;">
            <div class="preview-shell">
              <div class="preview-header">
                <h3 style="margin: 0;">${params.get('biz') || 'Business'}</h3>
                <div style="font-size: 0.8rem; margin-top: 0.25rem;">
                  ${countryFlag} ${countryName}
                </div>
              </div>
              <div class="preview-body">
                <p><strong>Special Offer:</strong> ${params.get('offer') || 'Check our promotion'}</p>
                ${params.get('phone') ? `<p>üìû ${params.get('phone')}</p>` : ''}
                ${params.get('email') ? `<p>üìß ${params.get('email')}</p>` : ''}
                ${params.get('addr') ? `<p>üìç ${params.get('addr')}</p>` : ''}
                ${params.get('img') ? `<img src="${params.get('img')}" style="width: 100%; border-radius: 0.5rem; margin: 0.5rem 0;">` : ''}
                <div style="margin-top: 1rem; padding: 0.5rem; background: #f0fdf4; border-radius: 0.25rem; text-align: center;">
                  <div style="font-size: 0.9rem; color: #666;">
                    Promo page created via Orbit Promo Pilot
                  </div>
                  <div style="font-size: 0.7rem; color: #9ca3af; margin-top: 0.25rem;">
                    Valid until: ${new Date(params.get('end')).toLocaleDateString()}
                  </div>
                </div>
              </div>
            </div>
          </div>
        `;
      }
    }

    // Check if viewing a promo page
    handlePromoView();
  </script>
</body>
</html>
